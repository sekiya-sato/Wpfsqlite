<Window x:Class="Wpfsqlite.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:local="clr-namespace:Wpfsqlite"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        Title="MainWindow"
        Width="1200"
        Height="900"
        FontSize="16"
        WindowStartupLocation="CenterScreen"
        mc:Ignorable="d"
        Loaded="Window_Loaded">

    <DockPanel>
        <Menu DockPanel.Dock="Top">
            <MenuItem Header="File  ">
                <MenuItem Click="OpenMenu_Click"
                          Header="Open..." />
                <MenuItem Click="CloseMenu_Click"
                          Header="Close" />
                <Separator />
                <MenuItem Click="ExitMenu_Click"
                          Header="Exit" />
            </MenuItem>
            <MenuItem Header="History    ">
                <MenuItem x:Name="OpenRecentMenu"
                          Header="Open Recent" />
            </MenuItem>
            <MenuItem Header="SQL History">
                <MenuItem x:Name="SqlHistoryMenu"
                          Header="Recent SQL" />
            </MenuItem>
        </Menu>

        <Grid>
            <Grid.ColumnDefinitions>
                <!--  allow left column to grow when dragging the center splitter  -->
                <ColumnDefinition Width="2*" />
                <ColumnDefinition Width="3*" />
            </Grid.ColumnDefinitions>

            <!--  Vertical splitter between left and right panes  -->
            <GridSplitter x:Name="CenterSplitter"
                          Grid.Column="0"
                          Width="6"
                          HorizontalAlignment="Right"
                          VerticalAlignment="Stretch"
                          Background="#EEE"
                          ResizeBehavior="PreviousAndNext"
                          ResizeDirection="Columns" />

            <!--  Left: Tabs for tables / keys  -->
            <Grid Grid.Column="0"
                  Margin="8">
                <!--  Top: original Tabs  -->
                <TabControl x:Name="TableListArea"
                            Grid.Row="0"
                            Margin="0,0,0,95"
                            SelectedIndex="{Binding SelectedTabIndex, Mode=TwoWay}">
                    <TabItem Header="Tables">
                        <ListBox MinWidth="160"
                                 MaxHeight="400"
                                 VerticalAlignment="Top"
                                 ItemsSource="{Binding Tables}"
                                 ScrollViewer.CanContentScroll="True"
                                 ScrollViewer.HorizontalScrollBarVisibility="Auto"
                                 ScrollViewer.VerticalScrollBarVisibility="Auto"
                                 SelectedItem="{Binding SelectedTable, Mode=TwoWay}"
                                 VirtualizingStackPanel.IsVirtualizing="True" />
                    </TabItem>
                    <TabItem Header="Keys">
                        <ListBox MinWidth="160"
                                 MaxHeight="400"
                                 VerticalAlignment="Top"
                                 ItemsSource="{Binding Keys}"
                                 ScrollViewer.CanContentScroll="True"
                                 ScrollViewer.HorizontalScrollBarVisibility="Auto"
                                 ScrollViewer.VerticalScrollBarVisibility="Auto"
                                 VirtualizingStackPanel.IsVirtualizing="True">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Margin="2"
                                                Orientation="Vertical">
                                        <TextBlock FontWeight="Bold"
                                                   Text="{Binding Name}" />
                                        <TextBlock FontStyle="Italic"
                                                   Foreground="Gray"
                                                   Text="{Binding SecondLine}" />
                                    </StackPanel>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </TabItem>
                    <TabItem x:Name="EditTab"
                             Header="Edit">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="5" />
                                <RowDefinition Height="*" />
                            </Grid.RowDefinitions>

                            <!--  Buttons at top of the Edit tab  -->
                            <StackPanel Grid.Row="0"
                                        Margin="0,6,0,0"
                                        HorizontalAlignment="Center"
                                        Orientation="Horizontal">
                                <Button Width="80"
                                        Margin="4"
                                        Command="{Binding SaveCurrentEditCommand}">
                                    修正
                                </Button>
                                <Button Width="80"
                                        Margin="4"
                                        Command="{Binding AddNewCommand}">
                                    追加
                                </Button>
                                <Button Width="80"
                                        Margin="4"
                                        Command="{Binding DeleteCurrentCommand}">
                                    削除
                                </Button>
                            </StackPanel>

                            <GridSplitter Grid.Row="1"
                                          Height="5"
                                          HorizontalAlignment="Stretch"
                                          VerticalAlignment="Center"
                                          Background="#EEE"
                                          ResizeBehavior="PreviousAndNext"
                                          ResizeDirection="Rows" />

                            <!--  Item area grows to fill remaining space in the tab  -->
                            <Border Grid.Row="2"
                                    Margin="0,8,0,0"
                                    Padding="6"
                                    BorderBrush="#DDD"
                                    BorderThickness="1"
                                    CornerRadius="4">
                                <ScrollViewer HorizontalScrollBarVisibility="Auto"
                                              VerticalScrollBarVisibility="Auto">
                                    <ItemsControl ItemsSource="{Binding Columns}">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <StackPanel Margin="0,2"
                                                            Orientation="Horizontal">
                                                    <Label Width="120"
                                                           Content="{Binding Name}" />
                                                    <TextBox Width="260"
                                                             Margin="6,0"
                                                             local:FocusBehavior.NotifyOnFocus="True"
                                                             Text="{Binding EditValue, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                                    <TextBlock Margin="6,0"
                                                               VerticalAlignment="Center"
                                                               Foreground="Gray"
                                                               Text="{Binding Type}" />
                                                    <CheckBox Margin="6,0"
                                                              Content="NotNull"
                                                              IsChecked="{Binding NotNull}"
                                                              IsEnabled="False" />
                                                    <CheckBox Margin="6,0"
                                                              Content="PK"
                                                              IsChecked="{Binding PrimaryKey}"
                                                              IsEnabled="False" />
                                                </StackPanel>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </ScrollViewer>
                            </Border>
                        </Grid>
                    </TabItem>
                </TabControl>
                <ScrollViewer x:Name="txtDetail"
                              Width="444"
                              Height="80"
                              Margin="0,760,0,0"
                              HorizontalAlignment="Center"
                              VerticalAlignment="Top"
                              HorizontalScrollBarVisibility="Disabled"
                              VerticalScrollBarVisibility="Auto">
                    <TextBlock Text="{Binding SelectedColumn.EditValue, Mode=OneWay}"
                               TextWrapping="Wrap" />
                </ScrollViewer>

                <!--  Splitter between top list and buttons/item area  -->

                <!--  Buttons: Modify / Add / Delete  -->

                <!--  Splitter between buttons and item area  -->

                <!--  Bottom: Columns for selected table  -->
            </Grid>

            <!--  Right: Query panel and Data grid  -->
            <Grid Grid.Column="1"
                  Margin="8">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="5" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <!--  Query editor and Execute button  -->
                <Grid Grid.Row="0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="110" />
                    </Grid.ColumnDefinitions>

                    <TextBox x:Name="QueryTextBox"
                             Grid.Column="0"
                             Height="110"
                             Margin="0,0,8,8"
                             VerticalAlignment="Top"
                             AcceptsReturn="True"
                             HorizontalScrollBarVisibility="Auto"
                             TextWrapping="Wrap"
                             VerticalScrollBarVisibility="Auto" />

                    <Button Grid.Column="1"
                            Width="100"
                            Height="32"
                            VerticalAlignment="Top"
                            Command="{Binding ExecuteQueryCommand}"
                            CommandParameter="{Binding Text, ElementName=QueryTextBox}">
                        Execute
                    </Button>
                </Grid>

                <!--  Splitter between query editor and data grid  -->
                <GridSplitter Grid.Row="1"
                              Height="5"
                              HorizontalAlignment="Stretch"
                              VerticalAlignment="Center"
                              Background="#EEE"
                              ResizeBehavior="PreviousAndNext"
                              ResizeDirection="Rows" />

                <Border Grid.Row="2"
                        BorderBrush="#DDD"
                        BorderThickness="1"
                        CornerRadius="4">
                    <DataGrid x:Name="ListArea"
                              AlternatingRowBackground="Wheat"
                              AlternationCount="2"
                              AutoGenerateColumns="True"
                              IsReadOnly="False"
                              ItemsSource="{Binding SelectedTableView}"
                              RowBackground="White"
                              SelectedItem="{Binding SelectedRow, Mode=TwoWay}" />
                </Border>
            </Grid>
        </Grid>
    </DockPanel>
</Window>
