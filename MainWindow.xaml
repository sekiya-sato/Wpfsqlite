<Window
    x:Class="Wpfsqlite.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:Wpfsqlite"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    Title="MainWindow"
    Width="1200"
    Height="900"
    mc:Ignorable="d">

    <DockPanel>
        <Menu DockPanel.Dock="Top">
            <MenuItem Header="File">
                <MenuItem Click="OpenMenu_Click" Header="Open..." />
                <MenuItem Click="CloseMenu_Click" Header="Close" />
                <Separator />
                <MenuItem Click="ExitMenu_Click" Header="Exit" />
            </MenuItem>
            <MenuItem Header="History">
                <MenuItem x:Name="OpenRecentMenu" Header="Open Recent" />
            </MenuItem>
            <MenuItem Header="SQL History">
                <MenuItem x:Name="SqlHistoryMenu" Header="Recent SQL" />
            </MenuItem>
        </Menu>

        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="280" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <!-- Vertical splitter between left and right panes -->
            <GridSplitter Grid.Column="0"
                          HorizontalAlignment="Right"
                          VerticalAlignment="Stretch"
                          Width="6"
                          Background="#EEE"
                          ResizeBehavior="PreviousAndNext"
                          ResizeDirection="Columns" />

            <!--  Left: Tabs for tables / keys  -->
            <Grid Grid.Column="0" Margin="8">
                <Grid.RowDefinitions>
                    <RowDefinition Height="7*" />
                    <RowDefinition Height="5" />
                    <RowDefinition Height="50" />
                    <RowDefinition Height="5" />
                    <RowDefinition Height="7*" />
                </Grid.RowDefinitions>

                <!--  Top: original Tabs  -->
                <TabControl x:Name="TableListArea" Grid.Row="0">
                    <TabItem Header="Tables">
                        <ListBox ItemsSource="{Binding Tables}"
                                 SelectedItem="{Binding SelectedTable, Mode=TwoWay}"
                                 ScrollViewer.VerticalScrollBarVisibility="Auto"
                                 ScrollViewer.HorizontalScrollBarVisibility="Auto"
                                 ScrollViewer.CanContentScroll="True"
                                 VirtualizingStackPanel.IsVirtualizing="True"
                                 MaxHeight="400"
                                 MinWidth="160"
                                 />
                    </TabItem>
                    <TabItem Header="Keys">
                        <ListBox ItemsSource="{Binding Keys}"
                                 ScrollViewer.VerticalScrollBarVisibility="Auto"
                                 ScrollViewer.HorizontalScrollBarVisibility="Auto"
                                 ScrollViewer.CanContentScroll="True"
                                 VirtualizingStackPanel.IsVirtualizing="True"
                                 MaxHeight="400"
                                 MinWidth="160">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Margin="2" Orientation="Vertical">
                                        <TextBlock FontWeight="Bold" Text="{Binding Name}" />
                                        <TextBlock
                                            FontStyle="Italic"
                                            Foreground="Gray"
                                            Text="{Binding SecondLine}" />
                                    </StackPanel>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </TabItem>
                </TabControl>

                <!-- Splitter between top list and buttons/item area -->
                <GridSplitter Grid.Row="1"
                              HorizontalAlignment="Stretch"
                              VerticalAlignment="Center"
                              Height="5"
                              Background="#EEE"
                              ResizeBehavior="PreviousAndNext"
                              ResizeDirection="Rows" />

                <!-- Buttons: Modify / Add / Delete -->
                <Grid x:Name="EditArea" Grid.Row="2" Margin="0,6,0,0">

                </Grid>

                    <StackPanel x:Name="CrudArea" Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,6,0,0" Width="264" Height="40">
                    <Button Width="80" Margin="4" Click="ModifyButton_Click">修正</Button>
                    <Button Width="80" Margin="4" Click="AddButton_Click">追加</Button>
                    <Button Width="80" Margin="4" Click="DeleteButton_Click">削除</Button>
                </StackPanel>

                <!-- Splitter between buttons and item area -->

                <!--  Bottom: Columns for selected table  -->
                <Border
                    x:Name="ItemArea"
                    Grid.Row="4"
                    Margin="0,8,0,0"
                    Padding="6"
                    BorderBrush="#DDD"
                    BorderThickness="1"
                    CornerRadius="4">
                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <ItemsControl ItemsSource="{Binding Columns}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Margin="0,2" Orientation="Horizontal">
                                        <Label Width="120" Content="{Binding Name}" />
                                        <TextBox
                                            Width="260"
                                            Margin="6,0"
                                            Text="{Binding EditValue, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                        <TextBlock Text="{Binding Type}" Margin="6,0" VerticalAlignment="Center" Foreground="Gray" />
                                        <CheckBox
                                            Margin="6,0"
                                            Content="NotNull"
                                            IsChecked="{Binding NotNull}"
                                            IsEnabled="False" />
                                        <CheckBox
                                            Margin="6,0"
                                            Content="PK"
                                            IsChecked="{Binding PrimaryKey}"
                                            IsEnabled="False" />
                                    </StackPanel>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                </Border>
            </Grid>

            <!--  Right: Query panel and Data grid  -->
            <Grid Grid.Column="1" Margin="8">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="5" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <!--  Query editor and Execute button  -->
                <Grid Grid.Row="0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="110" />
                    </Grid.ColumnDefinitions>

                    <TextBox
                        x:Name="QueryTextBox"
                        Grid.Column="0"
                        Height="110"
                        Margin="0,0,8,8"
                        VerticalAlignment="Top"
                        AcceptsReturn="True"
                        HorizontalScrollBarVisibility="Auto"
                        TextWrapping="Wrap"
                        VerticalScrollBarVisibility="Auto" />

                    <Button
                        Grid.Column="1"
                        Width="100"
                        Height="32"
                        VerticalAlignment="Top"
                        Click="ExecuteSql_Click">
                        Execute
                    </Button>
                </Grid>

                <!-- Splitter between query editor and data grid -->
                <GridSplitter Grid.Row="1"
                              HorizontalAlignment="Stretch"
                              VerticalAlignment="Center"
                              Height="5"
                              Background="#EEE"
                              ResizeBehavior="PreviousAndNext"
                              ResizeDirection="Rows" />

                <Border
                    Grid.Row="2"
                    BorderBrush="#DDD"
                    BorderThickness="1"
                    CornerRadius="4">
                    <DataGrid
                        x:Name="ListArea"
                        AutoGenerateColumns="True"
                        IsReadOnly="False"
                        ItemsSource="{Binding SelectedTableView}"
                        SelectionChanged="ListArea_SelectionChanged" />
                </Border>
            </Grid>
        </Grid>
    </DockPanel>
</Window>
